<taglib name="html" />	
<content>
<div style="float:left;margin-bottom: 10px;">
<a class="btn btn-success add">添加警戒线</a>
</div>

<div style="clear:both;"></div>
	<table class="table table-bordered table-hover">
		<tr>
			<th width="70px">序号</th>
			<th>已砍比例（%）</th>
			<th>随机范围</th>
			<th >备注</th>
			<th >操作</th>
		</tr>
		<tbody>
			<volist name="list" id="vo" key="k">
				<tr>
				<td>{$k}</td>
				<td>{$vo.kjr_yikan}</td>
				<td>{$vo.kjr_min}——{$vo.kjr_max}</td>
				<td>{$vo.kjr_beizhu}</td>
				<td width="150px"><a kjr_yikan="{$vo.kjr_yikan}" kjr_min={$vo.kjr_min} kjr_max={$vo.kjr_max} kir_beizhu="{$vo.kir_beizhu}" kjr_id="{$vo.kjr_id}" class="btn btn-info edit">编辑</a><a class="btn btn-danger del" kjr_id={$vo.kjr_id} style="margin-left: 10px;">删除</a></td>
			</tr>
			</volist>
		</tbody>
	</table>
</content>
<script type="text/javascript">
	$('.add').click(function(){
		layer.open({
		  type: 1,
		  title:"添加砍价规则",
		  scrollbar: false,
		  skin: 'layui-layer-rim', //加上边框
		  area: ['300px', '350px'], //宽高
		  content: '<div style="width:90%;text-align:center;margin-top:20px;"><form class="form-horizontal"><div class="form-group"><label class="col-sm-4 control-label">已砍比例(%)</label><input name="type" type="hidden" value="1"><input name="yikan" type="text" style="width:150px" class="col-sm-4 form-control" placeholder="输入已砍线"></div><div class="form-group"><label class="col-sm-4 control-label">最小值</label><input name="min" type="text" style="width:150px" class="col-sm-4 form-control" placeholder="输入随机最小金额"></div><div class="form-group"><label class="col-sm-4 control-label">最大值</label><input name="max" type="text" style="width:150px" class="col-sm-4 form-control" placeholder="输入随机最大金额"></div><div class="form-group"><label class="col-sm-4 control-label">备注(选)</label><input type="textarea" placeholder="备注可选填" name="beizhu" style="width: 150px" class="col-sm-4 form-control"></div></form><a style="width:100px;" class="btn btn-success" onclick="add()">确定</a>&nbsp;&nbsp;<a style="width:100px;" class="btn btn-default" onclick="cancel()">取消</a></div>',
		});
	});
	function add(){
		var yikan=$('input[name=yikan]').val();
		var min=$('input[name=min]').val();
		var max=$('input[name=max]').val();
		var beizhu=$('input[name=beizhu]').val();
		var type=$('input[name=type]').val();
		if(yikan==""){
			layer.msg('请输入完整信息',{icon:0});
			return false;
		}
		if(min==""){
			layer.msg('请输入完整信息',{icon:0});
			return false;
		}
		if(max==""){
			layer.msg('请输入完整信息',{icon:0});
			return false;
		}
		$.post("{:U('kanjia_add')}",{kjr_yikan:yikan,kjr_min:min,kjr_max:max,kjr_beizhu:beizhu,type:type},function(data){
			if(data.status){
				layer.msg(data.info,{icon:1});
				setTimeout(function(){
					window.location.reload(0);
				},1000);
			}
			else{
				layer.msg(data.info,{icon:0});
			}
		});
	}
	function cancel(){
		layer.closeAll();
	}
	
	$('.edit').click(function(){

		var kjr_yikan=$(this).attr('kjr_yikan');
		var kjr_min=$(this).attr('kjr_min');
		var kjr_max=$(this).attr('kjr_max');
		// var kjr_beizhu=$(this).attr('kjr_beizhu');
		var kjr_id=$(this).attr('kjr_id');
		layer.open({
		  type: 1,
		  title:"添加等级",
		  scrollbar: false,
		  skin: 'layui-layer-rim', //加上边框
		  area: ['300px', '350px'], //宽高
		  content: '<div style="width:90%;text-align:center;margin-top:20px;"><form class="form-horizontal"><div class="form-group"><input name="kjr_id" type="hidden" value="'+kjr_id+'"><label class="col-sm-4 control-label">已砍比例%</label><input name="kjr_yikan" value="'+kjr_yikan+'" type="text" style="width:150px" class="col-sm-4 form-control" placeholder="输入已砍比例"></div><div class="form-group"><label class="col-sm-4 control-label">最小值</label><input value="'+kjr_min+'" name="kjr_min" type="text" style="width:150px" class="col-sm-4 form-control" placeholder="输入最小金额"></div><div class="form-group"><label class="col-sm-4 control-label">最大值</label><input value="'+kjr_max+'" name="kjr_max" type="text" style="width:150px" class="col-sm-4 form-control" placeholder="输入最大金额"></div><div class="form-group"><label class="col-sm-4 control-label">备注(选)</label><input type="textarea" value="" placeholder="备注可选填" name="kjr_beizhu" style="width: 150px" class="col-sm-4 form-control"></div></form><a style="width:100px;" class="btn btn-success" onclick="edit()">确定</a>&nbsp;&nbsp;<a style="width:100px;" class="btn btn-default" onclick="cancel()">取消</a></div>',
		});
	});
	function edit(){
		var kjr_id=$('input[name=kjr_id]').val();
		var kjr_yikan=$('input[name=kjr_yikan]').val();
		var kjr_min=$('input[name=kjr_min]').val();
		var kjr_max=$('input[name=kjr_max]').val();
		var kjr_beizhu=$('input[name=kjr_beizhu]').val();
		if(kjr_yikan==""){
			layer.msg('请输入完整信息',{icon:0});
			return false;
		}
		if(kjr_min==""){
			layer.msg('请输入完整信息',{icon:0});
			return false;
		}
		if(kjr_max==""){
			layer.msg('请输入完整信息',{icon:0});
			return false;
		}
		$.post("{:U('kanjia_edit')}",{kjr_id:kjr_id,kjr_yikan:kjr_yikan,kjr_min:kjr_min,kjr_beizhu:kjr_beizhu,kjr_max:kjr_max},function(data){
			if(data.status){
				layer.msg(data.info,{icon:1});
				setTimeout(function(){
					window.location.reload(0);
				},1000);
			}
			else{
				layer.msg(data.info,{icon:0});
			}
		});
	}

	$('.del').click(function(){
		var kjr_id=$(this).attr('kjr_id');
		layer.confirm('您确定要【<span style="color:red">删除</span>】?',{
			title:'温馨提醒',
			btn:['确定','取消'],
			},function(){
				layer.load();
				$.post("{:U('del')}",{kjr_id:kjr_id},function(data){
					layer.closeAll('loading');
					if(data.status){
						layer.msg(data.info,{icon:1});
						setTimeout(function(){
							window.location.reload(0);
						},1000);
					}
					else{
						layer.msg(data.info,{icon:0});
					}
				});
			},
			function(){
				layer.closeAll();
			}
		);
	});
</script>